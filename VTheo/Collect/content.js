let t;

chrome.runtime.onMessage.addListener( function(request, sender, sendResponse){
       //localStorage["pages"] = request.pages;
       //console.log(localStorage["pages"])
       
       if(request.text === 'report_back'){
        //ytplayer = document.getElementById("movie_player");
        
        //console.log(document.getElementsByTagName('video')[0])
        //sendResponse(document.PlayerState)
        //sendResponse(document.all[0].outerHTML);
        document.getElementsByClassName("video-stream")[0].pause();
        console.log(document.getElementsByClassName("video-stream")[0].currentTime);
        sendResponse(document.getElementsByClassName("video-stream")[0].currentTime);
       }
    }
);

var svgString = 
'<svg width="36" height="36" viewBox="0 0 36 36" fill="none" xmlns="http://www.w3.org/2000/svg"><rect x="8" y="8" width="20" height="20" rx="10" fill="white"/><path fill-rule="evenodd" clip-rule="evenodd" d="M18.7854 27.9696C18.5262 27.9897 18.2643 28 18 28C17.7357 28 17.4738 27.9897 17.2146 27.9696L17.3174 26.6471C17.5424 26.6645 17.77 26.6735 18 26.6735C18.23 26.6735 18.4576 26.6645 18.6826 26.6471L18.7854 27.9696ZM15.6645 27.7258L15.9732 26.4357C15.5279 26.3291 15.0959 26.1882 14.6803 26.0158L14.1721 27.2412C14.6519 27.4401 15.1505 27.6028 15.6645 27.7258ZM12.7744 26.5277L13.4686 25.3973C13.0804 25.1589 12.7123 24.8908 12.3674 24.5959L11.5054 25.6042C11.9027 25.9439 12.3269 26.2529 12.7744 26.5277ZM10.3958 24.4946L11.4041 23.6326C11.1092 23.2877 10.8411 22.9196 10.6027 22.5314L9.47231 23.2256C9.74711 23.6731 10.0561 24.0973 10.3958 24.4946ZM8.75881 21.8279L9.98416 21.3197C9.81178 20.9041 9.67085 20.4721 9.56431 20.0268L8.27419 20.3355C8.39717 20.8495 8.55985 21.3481 8.75881 21.8279ZM8.03039 18.7854L9.35293 18.6826C9.33545 18.4576 9.32653 18.23 9.32653 18C9.32653 17.77 9.33545 17.5424 9.35293 17.3174L8.03039 17.2146C8.01025 17.4738 8 17.7357 8 18C8 18.2643 8.01025 18.5262 8.03039 18.7854ZM8.27419 15.6645L9.56431 15.9732C9.67085 15.5279 9.81178 15.0959 9.98416 14.6803L8.75881 14.1721C8.55985 14.6519 8.39717 15.1505 8.27419 15.6645ZM9.47231 12.7744L10.6027 13.4686C10.8411 13.0804 11.1092 12.7123 11.4041 12.3674L10.3958 11.5054C10.0561 11.9027 9.74711 12.3269 9.47231 12.7744ZM11.5054 10.3958L12.3674 11.4041C12.7123 11.1092 13.0804 10.8411 13.4686 10.6027L12.7744 9.47231C12.3269 9.74711 11.9027 10.0561 11.5054 10.3958ZM14.1721 8.75881L14.6803 9.98416C15.0959 9.81178 15.5279 9.67085 15.9732 9.56431L15.6645 8.27419C15.1505 8.39717 14.6519 8.55985 14.1721 8.75881ZM17.2146 8.03039C17.4738 8.01025 17.7357 8 18 8C18.2643 8 18.5262 8.01025 18.7854 8.03039L18.6826 9.35293C18.4576 9.33545 18.23 9.32653 18 9.32653C17.77 9.32653 17.5424 9.33545 17.3174 9.35293L17.2146 8.03039ZM20.3355 8.27419L20.0268 9.56431C20.4721 9.67085 20.9041 9.81178 21.3197 9.98416L21.8279 8.75881C21.3481 8.55985 20.8495 8.39717 20.3355 8.27419ZM23.2256 9.47231L22.5314 10.6027C22.9196 10.8411 23.2877 11.1092 23.6326 11.4041L24.4946 10.3958C24.0973 10.0561 23.6731 9.74711 23.2256 9.47231ZM25.6042 11.5054L24.5959 12.3674C24.8908 12.7123 25.1589 13.0804 25.3973 13.4686L26.5277 12.7744C26.2529 12.3269 25.9439 11.9027 25.6042 11.5054ZM27.2412 14.1721L26.0158 14.6803C26.1882 15.0959 26.3291 15.5279 26.4357 15.9732L27.7258 15.6645C27.6028 15.1505 27.4401 14.6519 27.2412 14.1721ZM27.9696 17.2146L26.6471 17.3174C26.6645 17.5424 26.6735 17.77 26.6735 18C26.6735 18.23 26.6645 18.4576 26.6471 18.6826L27.9696 18.7854C27.9897 18.5262 28 18.2643 28 18C28 17.7357 27.9897 17.4738 27.9696 17.2146ZM27.7258 20.3355L26.4357 20.0268C26.3291 20.4721 26.1882 20.9041 26.0158 21.3197L27.2412 21.8279C27.4401 21.3481 27.6028 20.8495 27.7258 20.3355ZM26.5277 23.2256L25.3973 22.5314C25.1589 22.9196 24.8908 23.2877 24.5959 23.6326L25.6042 24.4946C25.9439 24.0973 26.2529 23.6731 26.5277 23.2256ZM24.4946 25.6042L23.6326 24.5959C23.2877 24.8908 22.9196 25.1589 22.5314 25.3973L23.2256 26.5277C23.6731 26.2529 24.0973 25.9439 24.4946 25.6042ZM21.8279 27.2412L21.3197 26.0158C20.9041 26.1882 20.4721 26.3291 20.0268 26.4357L20.3355 27.7258C20.8495 27.6028 21.3481 27.4401 21.8279 27.2412Z" fill="black"/><path fill-rule="evenodd" clip-rule="evenodd" d="M22 27.1679C20.7751 27.7031 19.4222 28 18 28C16.5778 28 15.2249 27.7031 14 27.1679L14.5311 25.9523C15.5917 26.4157 16.764 26.6735 18 26.6735C19.236 26.6735 20.4083 26.4157 21.4689 25.9523L22 27.1679ZM8.83208 22L10.0477 21.4689C9.58426 20.4083 9.32653 19.236 9.32653 18C9.32653 16.764 9.58426 15.5917 10.0477 14.5311L8.83208 14C8.29689 15.2249 8 16.5778 8 18C8 19.4222 8.29689 20.7751 8.83208 22ZM14 8.83208C15.2249 8.29689 16.5778 8 18 8C19.4222 8 20.7751 8.29689 22 8.83208L21.4689 10.0477C20.4083 9.58426 19.236 9.32653 18 9.32653C16.764 9.32653 15.5917 9.58426 14.5311 10.0477L14 8.83208ZM27.1679 14L25.9523 14.5311C26.4157 15.5917 26.6735 16.764 26.6735 18C26.6735 19.236 26.4157 20.4083 25.9523 21.4689L27.1679 22C27.7031 20.7751 28 19.4222 28 18C28 16.5778 27.7031 15.2249 27.1679 14Z" fill="#0094FF"/><rect x="14.3" y="14.3" width="3.3" height="3.3" rx="1" fill="#0094FF"/><circle cx="20.25" cy="20.45" r="1.65" fill="#00D33B"/><path d="M21.891 15.6119C22.1583 15.7648 22.1598 16.1497 21.8937 16.3047L19.5832 17.6505C19.3171 17.8054 18.9831 17.6143 18.9819 17.3063L18.9716 14.6325C18.9705 14.3246 19.3031 14.1309 19.5703 14.2838L21.891 15.6119Z" fill="#AA04D3"/><path d="M15.6147 18.8781C15.7045 18.6017 16.0955 18.6017 16.1853 18.8781L16.3939 19.5202C16.4341 19.6438 16.5493 19.7275 16.6792 19.7275H17.3543C17.645 19.7275 17.7658 20.0993 17.5307 20.2702L16.9845 20.667C16.8794 20.7434 16.8354 20.8788 16.8755 21.0024L17.0841 21.6444C17.174 21.9208 16.8576 22.1507 16.6225 21.9798L16.0763 21.583C15.9712 21.5066 15.8288 21.5066 15.7237 21.583L15.1775 21.9798C14.9424 22.1507 14.626 21.9208 14.7159 21.6444L14.9245 21.0024C14.9646 20.8788 14.9206 20.7434 14.8155 20.667L14.2693 20.2702C14.0342 20.0993 14.155 19.7275 14.4457 19.7275H15.1208C15.2507 19.7275 15.3659 19.6438 15.4061 19.5202L15.6147 18.8781Z" fill="#FFA800"/></svg>'

var buttonWrapper = document.createElement("div");
buttonWrapper.innerHTML = svgString.trim();


var newBtn = document.createElement("button");
newBtn.className = "ytp-fullscreen-button ytp-button";
newBtn.title = "collect";
newBtn.append(buttonWrapper.firstChild);
console.log(newBtn)
newBtn.onclick = function() {
    chrome.runtime.sendMessage({
        type: 'timestamp',
        time: performBookmarkIconClickAction()
    },
        function (response) {
            performBookmarkIconClickAction()
        });
};
document.getElementsByClassName("ytp-right-controls")[0].append(newBtn);

function performBookmarkIconClickAction(  ) {
    document.getElementsByClassName("video-stream")[0].pause();
    return document.getElementsByClassName("video-stream")[0].currentTime;
}